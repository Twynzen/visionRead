<div class="app-container">
  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <h1 class="title">
        <mat-icon class="title-icon">camera_alt</mat-icon>
        SnapSight AI
      </h1>
      <p class="subtitle">Transform screenshots into accessible content with AI</p>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Capture Section -->
    <mat-card class="capture-card">
      <mat-card-header>
        <mat-card-title>Load Image</mat-card-title>
        <mat-card-subtitle>Capture, upload, or paste an image to analyze</mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <!-- Provider Selection -->
        <div class="provider-selection">
          <label>AI Provider:</label>
          <mat-select [(value)]="selectedProvider" class="provider-select">
            <mat-option value="openai">OpenAI GPT-4 Vision</mat-option>
            <mat-option value="siliconflow">SiliconFlow (Track Prize)</mat-option>
          </mat-select>
        </div>

        <!-- Action Buttons Grid -->
        <div class="action-buttons">
          <!-- Screen Capture Button -->
          <button
            mat-raised-button
            color="primary"
            class="action-button-item"
            (click)="captureScreen()"
            [disabled]="state().isCapturing || state().isPreviewing || state().isAnalyzing">
            @if (!state().isCapturing) {
              <mat-icon>screenshot</mat-icon>
            }
            @if (state().isCapturing) {
              <mat-spinner diameter="20"></mat-spinner>
            }
            <span>{{ state().isCapturing ? 'Capturing...' : 'Capture Screen' }}</span>
          </button>

          <!-- Upload Button -->
          <button
            mat-stroked-button
            color="primary"
            class="action-button-item"
            (click)="fileInput.click()"
            [disabled]="state().isPreviewing || state().isAnalyzing">
            <mat-icon>upload_file</mat-icon>
            <span>Upload Image</span>
          </button>
          <input
            #fileInput
            type="file"
            accept="image/*"
            style="display: none"
            (change)="onFileSelected($event)">

          <!-- Paste Hint -->
          <div class="paste-hint">
            <mat-icon>content_paste</mat-icon>
            <span>Or press Ctrl+V to paste</span>
          </div>
        </div>

        <!-- Drag & Drop Zone -->
        @if (!state().imageData && !state().isCapturing) {
          <div
            class="drop-zone"
            (drop)="onDrop($event)"
            (dragover)="onDragOver($event)">
            <mat-icon class="drop-icon">cloud_upload</mat-icon>
            <p class="drop-text">Drag and drop an image here</p>
          </div>
        }

        <!-- Preview Section with Confirmation -->
        @if (state().isPreviewing && state().imageData) {
          <div class="preview-section">
            <div class="preview-container">
              <img [src]="state().imageData" alt="Image preview" class="preview-image">
            </div>

            <div class="preview-actions">
              <button
                mat-raised-button
                color="primary"
                class="analyze-button"
                (click)="analyzeImage()">
                <mat-icon>psychology</mat-icon>
                <span>Analyze Image</span>
              </button>

              <button
                mat-stroked-button
                class="cancel-button"
                (click)="cancelPreview()">
                <mat-icon>close</mat-icon>
                <span>Cancel</span>
              </button>
            </div>

            <p class="preview-hint">
              <mat-icon>info</mat-icon>
              Review the image and click "Analyze Image" to continue
            </p>
          </div>
        }

        <!-- Analyzing State -->
        @if (state().isAnalyzing && state().imageData) {
          <div class="analyzing-section">
            <div class="preview-container analyzing">
              <img [src]="state().imageData" alt="Analyzing..." class="preview-image">
              <div class="analyzing-overlay">
                <mat-spinner diameter="60"></mat-spinner>
                <p>Analyzing with AI...</p>
              </div>
            </div>
          </div>
        }

        <!-- Error Message -->
        @if (state().error) {
          <div class="error-message">
            <mat-icon>error</mat-icon>
            <span>{{ state().error }}</span>
          </div>
        }
      </mat-card-content>
    </mat-card>

    <!-- Results Section -->
    @if (state().analysis) {
      <mat-card class="results-card">
        <mat-card-header>
          <mat-card-title>Analysis Results</mat-card-title>
          <mat-card-subtitle>AI-powered content analysis</mat-card-subtitle>
        </mat-card-header>

        <mat-card-content>
          <mat-tab-group animationDuration="300ms">
            <!-- Analysis Tab (Main) -->
            <mat-tab>
              <ng-template mat-tab-label>
                <mat-icon class="tab-icon">psychology</mat-icon>
                Analysis
              </ng-template>
              <div class="tab-content">
                <div class="analysis-section">
                  <h3 class="section-title">
                    <mat-icon>auto_awesome</mat-icon>
                    AI Analysis
                  </h3>
                  <p class="analysis-text">{{ state().analysis?.analysis }}</p>

                  <!-- Audio Player -->
                  @if (audioUrl()) {
                    <div class="audio-section">
                      <h4 class="audio-title">
                        <mat-icon>volume_up</mat-icon>
                        Audio Description
                      </h4>
                      <audio [src]="audioUrl()" controls class="audio-player"></audio>
                    </div>
                  } @else {
                    <div class="audio-loading">
                      <mat-spinner diameter="20"></mat-spinner>
                      <span>Generating audio...</span>
                    </div>
                  }
                </div>
              </div>
            </mat-tab>

            <!-- Markdown Tab -->
            <mat-tab>
              <ng-template mat-tab-label>
                <mat-icon class="tab-icon">description</mat-icon>
                Markdown
              </ng-template>
              <div class="tab-content">
                <div class="markdown-section">
                  <div
                    class="markdown-content"
                    [innerHTML]="renderedMarkdown()">
                  </div>
                  <button
                    mat-raised-button
                    color="primary"
                    (click)="downloadMarkdown()"
                    class="download-button">
                    <mat-icon>download</mat-icon>
                    Download Markdown
                  </button>
                </div>
              </div>
            </mat-tab>

            <!-- OCR Tab -->
            <mat-tab>
              <ng-template mat-tab-label>
                <mat-icon class="tab-icon">text_fields</mat-icon>
                OCR Text
              </ng-template>
              <div class="tab-content">
                <div class="ocr-section">
                  <h3 class="section-title">
                    <mat-icon>text_snippet</mat-icon>
                    Extracted Text
                  </h3>
                  @if (state().analysis?.ocrText) {
                    <pre class="ocr-text">{{ state().analysis?.ocrText }}</pre>
                  } @else {
                    <p class="ocr-text">{{ state().analysis?.analysis }}</p>
                    <p class="info-note">
                      <mat-icon>info</mat-icon>
                      OCR text is included in the analysis above
                    </p>
                  }
                </div>
              </div>
            </mat-tab>
          </mat-tab-group>
        </mat-card-content>
      </mat-card>
    }

    <!-- Features Section -->
    @if (!state().analysis && !state().imageData) {
      <div class="features-grid">
        <mat-card class="feature-card">
          <mat-icon class="feature-icon" color="primary">camera_alt</mat-icon>
          <h3>Screen Capture</h3>
          <p>Capture any part of your screen instantly</p>
        </mat-card>

        <mat-card class="feature-card">
          <mat-icon class="feature-icon" color="primary">upload_file</mat-icon>
          <h3>Upload Images</h3>
          <p>Drag & drop or select files from your device</p>
        </mat-card>

        <mat-card class="feature-card">
          <mat-icon class="feature-icon" color="primary">visibility</mat-icon>
          <h3>AI Vision</h3>
          <p>GPT-4 Vision analyzes and extracts text</p>
        </mat-card>

        <mat-card class="feature-card">
          <mat-icon class="feature-icon" color="primary">volume_up</mat-icon>
          <h3>Text-to-Speech</h3>
          <p>Listen with natural voice synthesis</p>
        </mat-card>
      </div>
    }
  </main>

  <!-- Footer -->
  <footer class="footer">
    <p>
      Built for <strong>YuKeSong2025 Hackathon</strong> |
      Theme: <strong>AI for Good</strong> |
      <a href="https://github.com/Twynzen/visionRead" target="_blank">GitHub</a>
    </p>
  </footer>
</div>
